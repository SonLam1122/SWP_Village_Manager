@{
    ViewData["Title"] = "Shipper All-in-One";
    Layout = "~/Views/Shared/_AdminWarehouse.cshtml";
    var orders = ViewBag.Orders as IEnumerable<dynamic>;
    var orderDetail = ViewBag.OrderDetail;
}
<div class="page-body">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h2>Shipper Dashboard</h2>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Số đơn hôm nay</h5>
                                <p class="card-text display-4">@ViewBag.TodayOrders</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Đã giao thành công</h5>
                                <p class="card-text display-4">@ViewBag.SuccessOrders</p>
                            </div>
                        </div>
                    </div>
                </div>
                <form method="get" class="mb-3">
                    <div class="row g-2">
                        <div class="col-md-3">
                            <input type="text" name="code" class="form-control" placeholder="Mã đơn hàng">
                        </div>
                        <div class="col-md-3">
                            <select name="status" class="form-control">
                                <option value="">-- Trạng thái --</option>
                                <option>Sẵn sàng giao</option>
                                <option>Đang lấy hàng</option>
                                <option>Đã lấy hàng</option>
                                <option>Đang giao hàng</option>
                                <option>Giao thành công</option>
                                <option>Giao thất bại</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" name="date" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary w-100">Lọc</button>
                        </div>
                    </div>
                </form>
                <table class="table table-bordered table-hover" id="orders-table">
                    <thead>
                        <tr>
                            <th>Mã đơn</th>
                            <th>Khách hàng</th>
                            <th>Địa chỉ</th>
                            <th>Trạng thái</th>
                            <th>Thời gian giao</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach(var order in orders)
                        {
                            <tr>
                                <td>@order.Code</td>
                                <td>@order.CustomerName</td>
                                <td>@order.Address</td>
                                <td>@order.Status</td>
                                <td>@order.DeliveryTime.ToString("dd/MM/yyyy HH:mm")</td>
                                <td>
                                    <button type="button" class="btn btn-info btn-sm" onclick="showDetail(@order.Id)">Chi tiết</button>
                                </td>
                            </tr>
                            <tr id="detail-row-@order.Id" style="display:none; background:#f9f9f9">
                                <td colspan="6">
                                    <div id="detail-content-@order.Id"></div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    function showDetail(id) {
        // Ẩn tất cả các dòng chi tiết khác
        document.querySelectorAll('[id^="detail-row-"]').forEach(function(row) {
            row.style.display = 'none';
        });
        // Hiện dòng chi tiết tương ứng
        var detailRow = document.getElementById('detail-row-' + id);
        detailRow.style.display = '';
        // Gọi ajax lấy chi tiết đơn hàng (ở đây demo dữ liệu mẫu)
        var html = '';
        if (id == 1) {
            html = `<b>Khách hàng:</b> Nguyễn Văn A<br>
                    <b>Địa chỉ:</b> Hà Nội<br>
                    <b>SĐT:</b> 0912345678<br>
                    <b>Trạng thái hiện tại:</b> Đang giao hàng<br>
                    <b>Sản phẩm:</b>
                    <ul><li>Sản phẩm 1 x 2</li><li>Sản phẩm 2 x 1</li></ul>
                    <b>Lịch sử trạng thái:</b>
                    <ul><li>${new Date(Date.now()-2*3600*1000).toLocaleString()} - Sẵn sàng giao</li><li>${new Date(Date.now()-1*3600*1000).toLocaleString()} - Đang giao hàng - Shipper đã nhận đơn</li></ul>
                    <form class='mt-2'>
                        <div class='row g-2'>
                            <div class='col-md-4'><select class='form-control'><option>Đang lấy hàng</option><option>Đã lấy hàng</option><option>Đang giao hàng</option><option>Giao thành công</option><option>Giao thất bại</option></select></div>
                            <div class='col-md-6'><input type='text' class='form-control' placeholder='Ghi chú (nếu có)'></div>
                            <div class='col-md-2'><button class='btn btn-success w-100'>Cập nhật</button></div>
                        </div>
                    </form>`;
        } else if (id == 2) {
            html = `<b>Khách hàng:</b> Trần Thị B<br>
                    <b>Địa chỉ:</b> HCM<br>
                    <b>SĐT:</b> 0987654321<br>
                    <b>Trạng thái hiện tại:</b> Đang giao hàng<br>
                    <b>Sản phẩm:</b>
                    <ul><li>Sản phẩm 3 x 1</li></ul>
                    <b>Lịch sử trạng thái:</b>
                    <ul><li>${new Date(Date.now()-3*3600*1000).toLocaleString()} - Sẵn sàng giao</li><li>${new Date(Date.now()-2*3600*1000).toLocaleString()} - Đang giao hàng - Shipper đã nhận đơn</li></ul>
                    <form class='mt-2'>
                        <div class='row g-2'>
                            <div class='col-md-4'><select class='form-control'><option>Đang lấy hàng</option><option>Đã lấy hàng</option><option>Đang giao hàng</option><option>Giao thành công</option><option>Giao thất bại</option></select></div>
                            <div class='col-md-6'><input type='text' class='form-control' placeholder='Ghi chú (nếu có)'></div>
                            <div class='col-md-2'><button class='btn btn-success w-100'>Cập nhật</button></div>
                        </div>
                    </form>`;
        } else {
            html = `<b>Khách hàng:</b> Lê Văn C<br>
                    <b>Địa chỉ:</b> Đà Nẵng<br>
                    <b>SĐT:</b> 0909090909<br>
                    <b>Trạng thái hiện tại:</b> Giao thành công<br>
                    <b>Sản phẩm:</b>
                    <ul><li>Sản phẩm 4 x 1</li></ul>
                    <b>Lịch sử trạng thái:</b>
                    <ul><li>${new Date(Date.now()-4*3600*1000).toLocaleString()} - Sẵn sàng giao</li><li>${new Date(Date.now()-2*3600*1000).toLocaleString()} - Giao thành công</li></ul>
                    <form class='mt-2'>
                        <div class='row g-2'>
                            <div class='col-md-4'><select class='form-control'><option>Đang lấy hàng</option><option>Đã lấy hàng</option><option>Đang giao hàng</option><option>Giao thành công</option><option>Giao thất bại</option></select></div>
                            <div class='col-md-6'><input type='text' class='form-control' placeholder='Ghi chú (nếu có)'></div>
                            <div class='col-md-2'><button class='btn btn-success w-100'>Cập nhật</button></div>
                        </div>
                    </form>`;
        }
        document.getElementById('detail-content-' + id).innerHTML = html;
    }
</script> 